2025-04-26 19:41:44 [WARNING] plugin.py:122 - Start: tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_list
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT DATABASE()
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT @@sql_mode
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT @@lower_case_table_names
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_job_log`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task_log`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - 
CREATE TABLE sys_task (
	task_uid VARCHAR(64) NOT NULL COMMENT '任务流UID，唯一标识', 
	task_name VARCHAR(64) COMMENT '任务流名称', 
	task_initiator VARCHAR(64) COMMENT '任务发起者', 
	task_group VARCHAR(64) COMMENT '任务流组名(mysql/redis)', 
	task_yaml JSON COMMENT '任务流依赖关系', 
	concurrent CHAR(1) COMMENT '是否并发执行（0允许 1禁止）', 
	cron_expression VARCHAR(255) COMMENT 'cron执行表达式', 
	misfire_policy VARCHAR(20) COMMENT '错误策略（1立即执行 2执行一次 3放弃执行）', 
	status CHAR(1) COMMENT '定时状态（0正常 1暂停）', 
	run_status VARCHAR(20) COMMENT '任务执行状态', 
	task_progress FLOAT(5, 4) COMMENT '执行进度（0-100%%）, 0未开始，-1失败, 1执行成功', 
	priority CHAR(1) COMMENT '任务优先级', 
	create_by VARCHAR(64) COMMENT '创建者', 
	create_time DATETIME NOT NULL COMMENT '创建时间' DEFAULT CURRENT_TIMESTAMP, 
	update_by VARCHAR(64) COMMENT '更新者', 
	update_time DATETIME COMMENT '更新时间' DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, 
	remark VARCHAR(500) COMMENT '备注信息', 
	PRIMARY KEY (task_uid), 
	UNIQUE (task_uid)
)COMMENT='定时任务流调度表'


2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00037s] ()
2025-04-26 19:41:44 [WARNING] asyncmy.py:107 - Specifying number of digits for floating point data types is deprecated and will be removed in a future release.
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_task_uid ON sys_task (task_uid)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00024s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - 
CREATE TABLE sys_job_log (
	job_log_id BIGINT NOT NULL COMMENT '任务日志ID' AUTO_INCREMENT, 
	job_uid VARCHAR(64) NOT NULL COMMENT '任务UID', 
	task_uid VARCHAR(64) NOT NULL COMMENT '任务流UID', 
	job_name VARCHAR(64) NOT NULL COMMENT '任务名称', 
	job_parties VARCHAR(128) COMMENT '任务参与方', 
	job_dependencies VARCHAR(2560) COMMENT '任务依赖关系', 
	job_executor VARCHAR(64) COMMENT '任务执行器', 
	invoke_target VARCHAR(500) NOT NULL COMMENT '调用目标字符串', 
	job_args VARCHAR(255) COMMENT '位置参数', 
	job_kwargs VARCHAR(2000) COMMENT '关键字参数', 
	job_message VARCHAR(500) COMMENT '日志信息', 
	status VARCHAR(1) NOT NULL COMMENT '执行状态', 
	exception_info VARCHAR(2000) COMMENT '异常信息', 
	create_time DATETIME COMMENT '创建时间', 
	PRIMARY KEY (job_log_id)
)COMMENT='定时任务调度日志表'


2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00039s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_job_uid ON sys_job_log (job_uid)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00039s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_status ON sys_job_log (status)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00045s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_time ON sys_job_log (create_time)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00044s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - 
CREATE TABLE sys_task_log (
	task_log_id BIGINT NOT NULL COMMENT '任务流日志ID' AUTO_INCREMENT, 
	task_uid VARCHAR(64) NOT NULL COMMENT '任务流UID', 
	task_name VARCHAR(64) NOT NULL COMMENT '任务流名称', 
	task_initiator VARCHAR(64) COMMENT '任务发起者', 
	task_group VARCHAR(64) NOT NULL COMMENT '任务流组名', 
	task_trigger VARCHAR(255) COMMENT '任务触发器', 
	task_message VARCHAR(500) COMMENT '日志信息', 
	exception_info VARCHAR(2000) COMMENT '异常信息', 
	create_time DATETIME NOT NULL COMMENT '创建时间' DEFAULT CURRENT_TIMESTAMP, 
	PRIMARY KEY (task_log_id)
)COMMENT='定时任务流调度日志表'


2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00051s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_task_uid ON sys_task_log (task_uid)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00047s] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - CREATE INDEX idx_time ON sys_task_log (create_time)
2025-04-26 19:41:44 [INFO] base.py:1901 - [no key 0.00047s] ()
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_job_log`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task_log`
2025-04-26 19:41:44 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT count(%s) AS count_1 
FROM (SELECT DISTINCT sys_task.task_uid AS task_uid, sys_task.task_name AS task_name, sys_task.task_initiator AS task_initiator, sys_task.task_group AS task_group, sys_task.task_yaml AS task_yaml, sys_task.concurrent AS concurrent, sys_task.cron_expression AS cron_expression, sys_task.misfire_policy AS misfire_policy, sys_task.status AS status, sys_task.run_status AS run_status, sys_task.task_progress AS task_progress, sys_task.priority AS priority, sys_task.create_by AS create_by, sys_task.create_time AS create_time, sys_task.update_by AS update_by, sys_task.update_time AS update_time, sys_task.remark AS remark 
FROM sys_task 
WHERE sys_task.task_group = %s AND sys_task.status = %s ORDER BY sys_task.task_uid) AS anon_1
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00090s] ('*', 'default', '1')
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT DISTINCT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_group = %s AND sys_task.status = %s ORDER BY sys_task.task_uid 
 LIMIT %s, %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00077s] ('default', '1', 0, 20)
2025-04-26 19:41:44 [INFO] base.py:1123 - ROLLBACK
2025-04-26 19:41:44 [INFO] _client.py:1740 - HTTP Request: GET http://localhost:9099/scheduler/task/list?page_num=1&page_size=20 "HTTP/1.1 200 OK"
2025-04-26 19:41:44 [INFO] plugin.py:190 - test status is PASSED (tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_list): 
2025-04-26 19:41:44 [WARNING] plugin.py:128 - End: tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_list
2025-04-26 19:41:44 [WARNING] plugin.py:122 - Start: tests/test_module_admin/test_controller/test_task_controller.py::test_add_task
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_name = %s AND sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00066s] ('task2', 'test_uid')
2025-04-26 19:41:44 [INFO] base.py:1896 - INSERT INTO sys_task (task_uid, task_name, task_initiator, task_group, task_yaml, concurrent, cron_expression, misfire_policy, status, run_status, task_progress, priority, create_by, create_time, update_by, update_time, remark) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00073s] ('test_uid', 'task2', 'alice', 'default', '[{"job_uid": "psi3", "job_executor": "default", "invoke_target": "module_task.scheduler_test.job", "job_args": "", "job_kwargs": "", "job_name": "psi ... (162 characters truncated) ... r_test.job", "job_args": "", "job_kwargs": "", "job_name": "psi2", "job_parties": "[\\"party1\\",\\"party2\\"]", "job_dependencies": "[\\"psi3\\"]"}]', '1', '0/10 * * * * ?', '3', '1', 'not started', 0, '0', 'admin', datetime.datetime(2025, 4, 26, 19, 41, 44, 750243), '', datetime.datetime(2025, 4, 26, 19, 41, 44, 750296), 'test')
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00056s] ('test_uid',)
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] _client.py:1740 - HTTP Request: POST http://localhost:9099/scheduler/task/add "HTTP/1.1 200 OK"
2025-04-26 19:41:44 [INFO] plugin.py:190 - test status is PASSED (tests/test_module_admin/test_controller/test_task_controller.py::test_add_task): 
2025-04-26 19:41:44 [WARNING] plugin.py:128 - End: tests/test_module_admin/test_controller/test_task_controller.py::test_add_task
2025-04-26 19:41:44 [WARNING] plugin.py:122 - Start: tests/test_module_admin/test_controller/test_task_controller.py::test_execute_task
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [cached since 0.02071s ago] ('test_uid',)
2025-04-26 19:41:44 [INFO] base.py:1896 - UPDATE sys_task SET run_status=%s, task_progress=%s WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00096s] ('running', 0, 'test_uid')
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - INSERT INTO sys_job_log (job_uid, task_uid, job_name, job_parties, job_dependencies, job_executor, invoke_target, job_args, job_kwargs, job_message, status, exception_info, create_time) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00080s] ('psi3', 'test_uid', 'psi1', '["party1","party2"]', '[]', 'default', 'module_task.scheduler_test.job', '', '', '任务开始执行', '0', '', datetime.datetime(2025, 4, 26, 19, 41, 44, 830217))
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] _client.py:1740 - HTTP Request: POST http://localhost:9099/scheduler/task/start?task_uid=test_uid "HTTP/1.1 200 OK"
2025-04-26 19:41:44 [INFO] plugin.py:190 - test status is PASSED (tests/test_module_admin/test_controller/test_task_controller.py::test_execute_task): 
2025-04-26 19:41:44 [WARNING] plugin.py:128 - End: tests/test_module_admin/test_controller/test_task_controller.py::test_execute_task
2025-04-26 19:41:44 [WARNING] plugin.py:122 - Start: tests/test_module_admin/test_controller/test_task_controller.py::test_stop_task
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [cached since 0.1541s ago] ('test_uid',)
2025-04-26 19:41:44 [INFO] base.py:1896 - UPDATE sys_task SET run_status=%s, update_time=%s WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [generated in 0.00069s] ('stopped', datetime.datetime(2025, 4, 26, 19, 41, 44, 969376), 'test_uid')
2025-04-26 19:41:44 [INFO] base.py:1140 - COMMIT
2025-04-26 19:41:44 [INFO] _client.py:1740 - HTTP Request: POST http://localhost:9099/scheduler/task/stop?task_uid=test_uid "HTTP/1.1 200 OK"
2025-04-26 19:41:44 [INFO] plugin.py:190 - test status is PASSED (tests/test_module_admin/test_controller/test_task_controller.py::test_stop_task): 
2025-04-26 19:41:44 [WARNING] plugin.py:128 - End: tests/test_module_admin/test_controller/test_task_controller.py::test_stop_task
2025-04-26 19:41:44 [WARNING] plugin.py:122 - Start: tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_detail
2025-04-26 19:41:44 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:44 [INFO] base.py:1896 - SELECT sys_task.task_uid, sys_task.task_name, sys_task.task_initiator, sys_task.task_group, sys_task.task_yaml, sys_task.concurrent, sys_task.cron_expression, sys_task.misfire_policy, sys_task.status, sys_task.run_status, sys_task.task_progress, sys_task.priority, sys_task.create_by, sys_task.create_time, sys_task.update_by, sys_task.update_time, sys_task.remark 
FROM sys_task 
WHERE sys_task.task_uid = %s
2025-04-26 19:41:44 [INFO] base.py:1901 - [cached since 0.2249s ago] ('test_uid',)
2025-04-26 19:41:44 [INFO] base.py:1123 - ROLLBACK
2025-04-26 19:41:44 [INFO] _client.py:1740 - HTTP Request: GET http://localhost:9099/scheduler/task/get?task_uid=test_uid "HTTP/1.1 200 OK"
2025-04-26 19:41:45 [INFO] plugin.py:190 - test status is PASSED (tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_detail): 
2025-04-26 19:41:45 [WARNING] plugin.py:128 - End: tests/test_module_admin/test_controller/test_task_controller.py::test_get_task_detail
2025-04-26 19:41:45 [WARNING] plugin.py:122 - Start: tests/test_utils/test_common_util.py::TestSnakeCaseUtil::test_camel_to_snake
2025-04-26 19:41:45 [INFO] plugin.py:190 - test status is PASSED (tests/test_utils/test_common_util.py::TestSnakeCaseUtil::test_camel_to_snake): 
2025-04-26 19:41:45 [WARNING] plugin.py:128 - End: tests/test_utils/test_common_util.py::TestSnakeCaseUtil::test_camel_to_snake
2025-04-26 19:41:45 [INFO] base.py:1097 - BEGIN (implicit)
2025-04-26 19:41:45 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task`
2025-04-26 19:41:45 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:45 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_job_log`
2025-04-26 19:41:45 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:45 [INFO] base.py:1896 - DESCRIBE `test_DAGScheduler_beng003`.`sys_task_log`
2025-04-26 19:41:45 [INFO] base.py:1901 - [raw sql] ()
2025-04-26 19:41:45 [INFO] base.py:1896 - 
DROP TABLE sys_task_log
2025-04-26 19:41:45 [INFO] base.py:1901 - [no key 0.00037s] ()
2025-04-26 19:41:45 [INFO] base.py:1896 - 
DROP TABLE sys_job_log
2025-04-26 19:41:45 [INFO] base.py:1901 - [no key 0.00038s] ()
2025-04-26 19:41:45 [INFO] base.py:1896 - 
DROP TABLE sys_task
2025-04-26 19:41:45 [INFO] base.py:1901 - [no key 0.00042s] ()
2025-04-26 19:41:45 [INFO] base.py:1140 - COMMIT
